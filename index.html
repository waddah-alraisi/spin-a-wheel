<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Spin a Wheel | Studio</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- Tailwind via CDN (for the same layout / classes) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <script src="https://kit.fontawesome.com/153c991bdb.js" crossorigin="anonymous"></script>

  <style>
    body {
      background: #f1f5f9;
      color: #0f172a;
    }
    /* Smooth scroll & transitions */
    * {
      scroll-behavior: smooth;
    }
    /* Hide number arrows (if you ever change input type) */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .dance-box{
      width: 320px;
      position: absolute;
      top: 50%;
      left: calc(100% + 40px); /* places it nicely to the right of the wheel */
      transform: translateY(-50%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-image: url(https://i.pinimg.com/originals/57/e2/09/57e209296e586933febadf06e271a3d3.gif);
      background-size: cover;
      background-repeat: no-repeat;
      font-size: 18px;
      font-weight: bolder;
      line-height: 1.3;
      pointer-events: none;
    }

    .hidden {
      display: none !important;
    }

  </style>
</head>
<body class="min-h-screen flex flex-col">
  <div id="app" class="flex-1 flex flex-col">
    <!-- Header (same layout) -->
    <header class="bg-white border-b border-gray-200 shadow-sm">
      <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl flex items-center justify-center text-primary text-2xl">
            <i class="fa-kit fa-osos-logo text-4xl"></i>
          </div>
          <div>
            <h1 class="text-2xl font-bold text-gray-900">Spin a Wheel</h1>
            <p class="text-sm text-gray-500">OSOS Connect | Marketing</p>
          </div>
        </div>
      </div>
    </header>

    <!-- Main layout -->
    <main
      class="flex-1 max-w-7xl mx-auto w-full px-4 py-8 grid gap-8 lg:grid-cols-[minmax(0,2fr)_minmax(0,1.2fr)] items-start"
    >
      <!-- Wheel section -->
      <section
        class="bg-white border border-slate-200 rounded-2xl shadow-sm p-6 flex flex-col items-center gap-6"
      >
        <div class="w-full flex flex-col items-center gap-6">
          <div class="relative">

            <div id="dance-box-1" class="dance-box hidden" style="left:65%;">
                OSOS ERP OSOS HCM OSOS QHSE OSOS FleetRP OSOS CRM OSOS GAITH
                * * * * OSOS SRM OSOS EduRP OSOS Talents OSOS EDMS OSOS ERP OSOS
                HCM OSOS QHSE OSOS FleetRP OSOS CRM OSOS GAITH OSOS SRM OSOS
                * * * * OSOS SRM OSOS EduRP OSOS Talents OSOS EDMS OSOS ERP OSOS
                HCM OSOS QHSE OSOS FleetRP OSOS CRM OSOS GAITH OSOS SRM OSOS
                * * * * OSOS SRM OSOS EduRP OSOS Talents OSOS EDMS OSOS ERP OSOS
                HCM OSOS QHSE OSOS FleetRP OSOS CRM OSOS GAITH OSOS SRM OSOS
                * * * * OSOS SRM OSOS EduRP OSOS Talents OSOS EDMS OSOS ERP OSOS
            </div>

            <div id="dance-box-2" class="dance-box hidden" style="left:-65%;">
                OSOS ERP OSOS HCM OSOS QHSE OSOS FleetRP OSOS CRM OSOS GAITH
                * * * * OSOS SRM OSOS EduRP OSOS Talents OSOS EDMS OSOS ERP OSOS
                HCM OSOS QHSE OSOS FleetRP OSOS CRM OSOS GAITH OSOS SRM OSOS
                * * * * OSOS SRM OSOS EduRP OSOS Talents OSOS EDMS OSOS ERP OSOS
                HCM OSOS QHSE OSOS FleetRP OSOS CRM OSOS GAITH OSOS SRM OSOS
                * * * * OSOS SRM OSOS EduRP OSOS Talents OSOS EDMS OSOS ERP OSOS
                HCM OSOS QHSE OSOS FleetRP OSOS CRM OSOS GAITH OSOS SRM OSOS
                * * * * OSOS SRM OSOS EduRP OSOS Talents OSOS EDMS OSOS ERP OSOS
            </div>

            <canvas
              id="wheel-canvas"
              width="380"
              height="380"
              class="max-w-full drop-shadow-sm"
            ></canvas>

            <!-- Pointer triangle -->
            <div class="absolute -top-6 left-1/2 -translate-x-1/2 w-0 h-0 border-l-[20px] border-r-[20px] border-t-[30px] border-l-transparent border-r-transparent border-t-red-500 drop-shadow"></div>

            <!-- Center label -->
            <div
              class="absolute inset-0 flex items-center justify-center pointer-events-none"
            >
              <div
                class="w-20 h-20 rounded-full bg-white shadow flex items-center justify-center border border-slate-200"
              >
                <span
                  id="wheel-center-label"
                  class="text-[11px] font-semibold text-slate-700 text-center leading-tight"
                >
                  TAP TO<br />SPIN
                </span>
              </div>
            </div>
          </div>

          <!-- Spin button -->
          <button
            id="spin-button"
            class="px-8 py-3 rounded-full bg-gradient-to-r from-blue-500 to-indigo-500 text-white font-semibold text-sm tracking-wide shadow hover:shadow-md active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed"
          >
            SPIN THE WHEEL
          </button>
        </div>

        <!-- Small helper text -->
        <p class="text-xs text-slate-500 mt-2 text-center">
          Click the button or tap the wheel to start the spin.
        </p>
      </section>

      <!-- Right side: Employees for wheel + Employees pool -->
      <section class="bg-white border border-slate-200 rounded-2xl shadow-sm p-6 flex flex-col gap-5">
        <!-- Import JSON -->
        <div class="flex items-center justify-between gap-3 mb-3">
          <label for="import-json-input" class="text-sm font-medium text-slate-800">
            Import initial data (JSON)
          </label>
          <input
            id="import-json-input"
            type="file"
            accept="application/json"
            class="text-xs file:mr-2 file:px-2 file:py-1 file:rounded-md file:border-0 file:bg-slate-200 file:text-slate-700 hover:file:bg-slate-300"
          />
        </div>

        <!-- Number of groups -->
        <div class="flex items-center justify-between gap-3 mb-2">
          <label for="group-count-input" class="text-sm font-medium text-slate-800">
            Number of groups / employees per draw
          </label>
          <input
            id="group-count-input"
            type="number"
            min="1"
            value="1"
            class="w-20 px-2 py-1 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-right"
          />
        </div>

        <!-- Employees (Wheel) header -->
        <div class="flex items-center justify-between gap-3">
          <div class="flex items-center justify-between w-full">
            <h2 class="text-lg font-semibold text-slate-900">Employees (Wheel)</h2>          
            <button id="toggle-entries-btn" class="text-sm px-3 py-1 rounded-md bg-slate-200 hover:bg-slate-300 text-slate-700">Hide</button>
          </div>          
        </div>

        <!-- Employees (Wheel) accordion body -->
        <div id="entries-container">
          <!-- Add entry -->
          <form id="add-entry-form" class="flex gap-3 mt-2">
            <input
              id="new-entry-input"
              type="text"
              class="flex-1 px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              placeholder="Add a new name and press Enter or +"
            />
            <button
              type="submit"
              class="px-4 py-2 rounded-lg bg-blue-500 text-white text-sm font-medium shadow-sm hover:bg-blue-600"
            >
              +
            </button>
          </form>

          <!-- Entries list -->
          <div
            id="entries-list"
            class="space-y-2 max-h-[260px] overflow-y-auto pr-1 mt-3"
          ></div>

          <!-- Stats -->
          <div
            class="mt-3 pt-3 border-t border-slate-200 grid grid-cols-2 gap-4 text-center"
          >
            <div>
              <p
                id="entries-count"
                class="text-2xl font-bold text-blue-600 leading-tight"
              >
                0
              </p>
              <p class="text-xs text-gray-600">Total Employees (Wheel)</p>
            </div>
            <div>
              <p
                id="times-spun"
                class="text-2xl font-bold text-purple-600 leading-tight"
              >
                0
              </p>
              <p class="text-xs text-gray-600">Times Spun</p>
            </div>
          </div>
        </div>

        <!-- Employees pool accordion -->
        <div class="mt-6 pt-4 border-t border-slate-200">
          <div class="flex items-center justify-between w-full mb-2">
            <h2 class="text-md font-semibold text-slate-900">Employees Pool</h2>
            <button id="toggle-employees-btn" class="text-sm px-3 py-1 rounded-md bg-slate-200 hover:bg-slate-300 text-slate-700">Hide</button>
          </div>

          <div id="employees-container">
            <!-- Add employee -->
            <form id="add-employee-form" class="flex gap-3">
              <input
                id="new-employee-input"
                type="text"
                class="flex-1 px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="Add employee name and press Enter or +"
              />
              <button
                type="submit"
                class="px-4 py-2 rounded-lg bg-green-500 text-white text-sm font-medium shadow-sm hover:bg-green-600"
              >
                +
              </button>
            </form>

            <!-- Employees list -->
            <div
              id="employees-list"
              class="space-y-2 max-h-[220px] overflow-y-auto pr-1 mt-3"
            ></div>

            <div class="mt-2 text-xs text-gray-600">
              Total Employees: <span id="employees-count">0</span>
            </div>
          </div>

          <!-- Selected Groups accordion -->
          <div class="mt-6 pt-4 border-t border-slate-200">
            <div class="flex items-center justify-between w-full mb-2">
              <h2 class="text-md font-semibold text-slate-900">Selected Groups</h2>
              <button
                id="toggle-groups-btn"
                class="text-sm px-3 py-1 rounded-md bg-slate-200 hover:bg-slate-300 text-slate-700"
              >
                Hide
              </button>
            </div>
          
            <div id="groups-container">
              <div
                id="groups-list"
                class="space-y-2 max-h-[220px] overflow-y-auto pr-1 text-sm text-slate-700"
              ></div>
            </div>
          </div>
          
        </div>

      </section>
    </main>

    <!-- Result Modal -->
    <div
      id="result-modal"
      class="fixed inset-0 z-30 hidden items-center justify-center bg-black/40 backdrop-blur-sm"
    >
      <div
        class="bg-white rounded-2xl shadow-xl max-w-sm w-full mx-4 p-6 space-y-5 relative"
      >
        <button
          id="result-close-x"
          class="absolute top-3 right-3 text-slate-400 hover:text-slate-600"
          aria-label="Close"
        >
          ✕
        </button>

        <div class="text-center space-y-2">
          <p class="text-xs font-semibold tracking-[.2em] text-blue-500">
            RESULT
          </p>
          <p class="text-2xl font-bold text-slate-900" id="result-name">
            Winner
          </p>
          <p class="text-sm text-slate-500">
            Selected entry and its employees are shown below.
          </p>
        </div>

        <!-- Selected employees under the entry -->
        <div
          id="result-employees-wrapper"
          class="mt-4 text-left text-sm text-slate-700 hidden"
        >
          <p class="font-semibold mb-1">
            Selected Employees for this entry:
          </p>
          <ul
            id="result-employees-list"
            class="list-disc list-inside space-y-1"
          ></ul>
        </div>

        <div class="flex gap-3 mt-4">
          <button
            id="result-keep-button"
            class="flex-1 px-4 py-3 rounded-lg bg-blue-500 text-white text-sm font-medium hover:bg-blue-600"
          >
            Great!
          </button>
          <button
            id="result-remove-button"
            class="px-4 py-3 rounded-lg bg-red-100 text-red-700 text-sm font-medium hover:bg-red-200"
            title="Remove this entry from the wheel"
          >
            Remove
          </button>
        </div>
      </div>
    </div>

    <!-- "Let the Game Begins" Modal -->
    <div
      id="setup-modal"
      class="fixed inset-0 z-40 hidden items-center justify-center bg-black/40 backdrop-blur-sm"
    >
      <div
        class="bg-white rounded-2xl shadow-xl max-w-sm w-full mx-4 p-6 space-y-4 relative"
      >
        <button
          id="setup-close-btn"
          class="absolute top-3 right-3 text-slate-400 hover:text-slate-600"
          aria-label="Close"
        >
          ✕
        </button>

        <div class="text-center space-y-2">
          <p class="text-xs font-semibold tracking-[.2em] text-green-500">
            LET THE GAME BEGINS
          </p>
          <p class="text-lg font-bold text-slate-900">
            Let the Game Begins
          </p>
          <p class="text-sm text-slate-500" id="setup-message">
            Please review the setup before starting the game.
          </p>
        </div>
      </div>
    </div>

    <!-- Confetti Canvas -->
    <canvas
      id="confetti-canvas"
      class="fixed inset-0 pointer-events-none z-40 hidden"
    ></canvas>
  </div>

  <!-- Vanilla JS logic -->
  <script>
    // Outside DOMContentLoaded: elements already exist because script is at end of body
    const danceBox1 = document.getElementById("dance-box-1");
    const danceBox2 = document.getElementById("dance-box-2");
    const toggleEntriesBtn = document.getElementById("toggle-entries-btn");
    const entriesContainer = document.getElementById("entries-container");
    const toggleEmployeesBtn = document.getElementById("toggle-employees-btn");
    const employeesContainer = document.getElementById("employees-container");
    const toggleGroupsBtn = document.getElementById("toggle-groups-btn");
    const groupsContainer = document.getElementById("groups-container");

    const setupModal = document.getElementById("setup-modal");
    const setupCloseBtn = document.getElementById("setup-close-btn");
    const setupMessageEl = document.getElementById("setup-message");

    let entriesVisible = true;
    toggleEntriesBtn.addEventListener("click", () => {
      entriesVisible = !entriesVisible;
      if (entriesVisible) {
        entriesContainer.classList.remove("hidden");
        toggleEntriesBtn.textContent = "Hide";
      } else {
        entriesContainer.classList.add("hidden");
        toggleEntriesBtn.textContent = "Show";
      }
    });

    let employeesVisible = true;
    toggleEmployeesBtn.addEventListener("click", () => {
      employeesVisible = !employeesVisible;
      if (employeesVisible) {
        employeesContainer.classList.remove("hidden");
        toggleEmployeesBtn.textContent = "Hide";
      } else {
        employeesContainer.classList.add("hidden");
        toggleEmployeesBtn.textContent = "Show";
      }
    });

    let groupsVisible = true;
    toggleGroupsBtn.addEventListener("click", () => {
      groupsVisible = !groupsVisible;
      if (groupsVisible) {
        groupsContainer.classList.remove("hidden");
        toggleGroupsBtn.textContent = "Hide";
      } else {
        groupsContainer.classList.add("hidden");
        toggleGroupsBtn.textContent = "Show";
      }
    });


    window.addEventListener("DOMContentLoaded", function () {
      // ===== STATE =====
      const COLORS = [
        "#ACB5BF",
        "#D5CFDA",
        "#ECA82E",
        "#ECCB93",
        "#65C841",
        "#8FBDE6",
        "#F5F4F5",
        "#E8E8E8",
        "#C0C0BF",
        "#8B1533"
      ];

      let entries = [
        "EasyRP",
        "EduRP",
        "SRM",
        "CRM",
        "FleetRP",
        "GAITH",
        "EDMS",
        "Talents"
      ];
      let employees = []; // pool of employees
      let selectedEntry = null;
      let isSpinning = false;
      let timesSpun = 0;
      let groups = []; // selected groups history

      
      const groupsList = document.getElementById("groups-list");

      // Wheel animation state
      const canvas = document.getElementById("wheel-canvas");
      const ctx = canvas.getContext("2d");
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = Math.min(centerX, centerY) - 10;

      let currentAngle = -Math.PI / 2; // so top is 0
      let startAngle = currentAngle;
      let targetAngle = currentAngle;
      let spinStartTime = 0;
      const spinDuration = 4500; // ms

      // DOM elements
      const spinButton = document.getElementById("spin-button");
      const centerLabel = document.getElementById("wheel-center-label");
      const addEntryForm = document.getElementById("add-entry-form");
      const newEntryInput = document.getElementById("new-entry-input");
      const entriesList = document.getElementById("entries-list");
      const entriesCount = document.getElementById("entries-count");
      const timesSpunEl = document.getElementById("times-spun");
      const groupCountInput = document.getElementById("group-count-input");
      const importJsonInput = document.getElementById("import-json-input");

      const addEmployeeForm = document.getElementById("add-employee-form");
      const newEmployeeInput = document.getElementById("new-employee-input");
      const employeesList = document.getElementById("employees-list");
      const employeesCount = document.getElementById("employees-count");

      const resultModal = document.getElementById("result-modal");
      const resultNameEl = document.getElementById("result-name");
      const resultCloseX = document.getElementById("result-close-x");
      const resultKeepButton =
        document.getElementById("result-keep-button");
      const resultRemoveButton = document.getElementById(
        "result-remove-button"
      );
      const resultEmployeesWrapper = document.getElementById(
        "result-employees-wrapper"
      );
      const resultEmployeesList = document.getElementById(
        "result-employees-list"
      );

      const confettiCanvas =
        document.getElementById("confetti-canvas");
      const confettiCtx = confettiCanvas.getContext("2d");
      let confettiPieces = [];
      let confettiActive = false;

      // ===== CONFETTI HELPERS =====
      function initConfettiCanvas() {
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;
      }

      window.addEventListener("resize", () => {
        if (!confettiActive) return;
        initConfettiCanvas();
      });

      function launchConfetti() {
        initConfettiCanvas();
        confettiPieces = [];
        const count = 180;
        for (let i = 0; i < count; i++) {
          confettiPieces.push({
            x: Math.random() * confettiCanvas.width,
            y: Math.random() * confettiCanvas.height - confettiCanvas.height,
            w: 6 + Math.random() * 4,
            h: 8 + Math.random() * 6,
            color:
              "hsl(" +
              Math.floor(Math.random() * 360) +
              ",100%,50%)",
            speed: 2 + Math.random() * 3,
            tilt: Math.random() * Math.PI,
            tiltSpeed: 0.02 + Math.random() * 0.03,
          });
        }

        confettiCanvas.classList.remove("hidden");
        confettiActive = true;
        const start = performance.now();

        function animateConfetti(now) {
          const elapsed = now - start;
          confettiCtx.clearRect(
            0,
            0,
            confettiCanvas.width,
            confettiCanvas.height
          );

          confettiPieces.forEach((p) => {
            p.y += p.speed;
            p.x += Math.sin(p.tilt) * 1.5;
            p.tilt += p.tiltSpeed;
            if (p.y > confettiCanvas.height) {
              p.y = -10;
            }
            confettiCtx.save();
            confettiCtx.translate(p.x, p.y);
            confettiCtx.rotate(p.tilt);
            confettiCtx.fillStyle = p.color;
            confettiCtx.fillRect(
              -p.w / 2,
              -p.h / 2,
              p.w,
              p.h
            );
            confettiCtx.restore();
          });

          if (elapsed < 2500) {
            requestAnimationFrame(animateConfetti);
          } else {
            confettiActive = false;
            confettiCanvas.classList.add("hidden");
          }
        }

        requestAnimationFrame(animateConfetti);
      }

      // ===== "Let the Game Begins" Modal helpers =====
      function showSetupModal(message) {
        if (message) {
          setupMessageEl.textContent = message;
        }
        setupModal.classList.remove("hidden");
        setupModal.classList.add("flex");
        launchConfetti();
      }

      function closeSetupModal() {
        setupModal.classList.remove("flex");
        setupModal.classList.add("hidden");
      }

      setupCloseBtn.addEventListener("click", closeSetupModal);
      setupModal.addEventListener("click", (e) => {
        if (e.target === setupModal) closeSetupModal();
      });

      // Validate configuration: wheel, pool, remainder
      function validateGameConfig() {
        let groupCount = parseInt(groupCountInput.value, 10);
        if (isNaN(groupCount) || groupCount < 1) groupCount = 1;

        const wheelCount = entries.length;
        const poolCount = employees.length;
        const problems = [];

        // 1) Employees (Wheel) is empty
        if (wheelCount === 0) {
          problems.push("Employees (Wheel) list is empty.");
        }

        // 2) Remaining items in Employees Pool are less than group size
        //    (0 is also considered "not enough to form a group")
        if (poolCount < groupCount) {
          problems.push(
            `Employees Pool has ${poolCount} employee(s), but each group requires ${groupCount}.`
          );
        }

        return {
          ok: problems.length === 0,
          message: problems.join(" ")
        };
      }



      // ===== WHEEL DRAWING =====
      function drawWheel() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (!entries.length) {
          // Empty wheel state
          ctx.save();
          ctx.translate(centerX, centerY);
          ctx.beginPath();
          ctx.arc(0, 0, radius, 0, Math.PI * 2);
          ctx.fillStyle = "#e5e7eb";
          ctx.fill();
          ctx.restore();
          return;
        }

        const sliceAngle = (Math.PI * 2) / entries.length;

        ctx.save();
        ctx.translate(centerX, centerY);
        ctx.rotate(currentAngle);

        // Draw slices
        entries.forEach((name, i) => {
          const start = i * sliceAngle;
          const end = start + sliceAngle;
          ctx.beginPath();
          ctx.moveTo(0, 0);
          ctx.arc(0, 0, radius, start, end);
          ctx.closePath();
          ctx.fillStyle = COLORS[i % COLORS.length];
          ctx.fill();
          ctx.strokeStyle = "rgba(15,23,42,0.12)";
          ctx.lineWidth = 1;
          ctx.stroke();
        });

        // Draw labels
        ctx.fillStyle = "#111827";
        ctx.font = "bold 14px system-ui, -apple-system, sans-serif";
        ctx.textAlign = "right";
        ctx.textBaseline = "middle";

        entries.forEach((name, i) => {
          const sliceCenter = i * sliceAngle + sliceAngle / 2;
          ctx.save();
          ctx.rotate(sliceCenter);
          ctx.translate(radius - 12, 0);
          ctx.rotate(Math.PI / 2); // keep text upright
          const text =
            name.length > 18 ? name.slice(0, 17) + "…" : name;
          ctx.fillText(text, 0, 0);
          ctx.restore();
        });

        ctx.restore();
      }

      // ===== ENTRIES (Employees for wheel) UI =====
      function renderEntries() {
        entriesList.innerHTML = "";

        entries.forEach((name, index) => {
          const row = document.createElement("div");
          row.className =
            "flex items-center gap-2 justify-between rounded-lg border border-slate-200 bg-slate-50 px-3 py-2";

          const input = document.createElement("input");
          input.type = "text";
          input.value = name;
          input.className =
            "flex-1 bg-transparent border-none text-sm focus:outline-none focus:ring-0";
          input.addEventListener("change", (e) => {
            const v = e.target.value.trim();
            entries[index] = v || `Entry ${index + 1}`;
            updateStats();
            drawWheel();
          });

          // Highlight row if it's the last selected
          if (selectedEntry && selectedEntry === name) {
            row.classList.add("ring-2", "ring-blue-400");
          }

          const removeBtn = document.createElement("button");
          removeBtn.type = "button";
          removeBtn.className =
            "text-xs px-2 py-1 rounded-md bg-red-100 text-red-700 hover:bg-red-200";
          removeBtn.textContent = "Delete";
          removeBtn.addEventListener("click", () => {
            entries.splice(index, 1);
            if (!entries.includes(selectedEntry)) {
              selectedEntry = null;
            }
            updateStats();
            renderEntries();
            drawWheel();
          });

          row.appendChild(input);
          row.appendChild(removeBtn);
          entriesList.appendChild(row);
        });

        updateStats();
      }

      function updateStats() {
        entriesCount.textContent = String(entries.length);
        timesSpunEl.textContent = String(timesSpun);
      }

      // ===== EMPLOYEES POOL UI =====
      function updateEmployeesCount() {
        employeesCount.textContent = String(employees.length);
      }

      function renderEmployees() {
        employeesList.innerHTML = "";

        employees.forEach((name, index) => {
          const row = document.createElement("div");
          row.className =
            "flex items-center gap-2 justify-between rounded-lg border border-slate-200 bg-slate-50 px-3 py-2";

          const input = document.createElement("input");
          input.type = "text";
          input.value = name;
          input.className =
            "flex-1 bg-transparent border-none text-sm focus:outline-none focus:ring-0";
          input.addEventListener("change", (e) => {
            const v = e.target.value.trim();
            employees[index] = v || `Employee ${index + 1}`;
            updateEmployeesCount();
          });

          const removeBtn = document.createElement("button");
          removeBtn.type = "button";
          removeBtn.className =
            "text-xs px-2 py-1 rounded-md bg-red-100 text-red-700 hover:bg-red-200";
          removeBtn.textContent = "Delete";
          removeBtn.addEventListener("click", () => {
            employees.splice(index, 1);
            updateEmployeesCount();
            renderEmployees();
          });

          row.appendChild(input);
          row.appendChild(removeBtn);
          employeesList.appendChild(row);
        });

        updateEmployeesCount();
      }

      // ===== RESULT MODAL =====
      function showResultModal(name) {
        resultNameEl.textContent = name || "—";
        resultModal.classList.remove("hidden");
        resultModal.classList.add("flex");
      }

      function closeResultModal() {
        resultModal.classList.remove("flex");
        resultModal.classList.add("hidden");
      }

      resultCloseX.addEventListener("click", closeResultModal);
      resultKeepButton.addEventListener("click", closeResultModal);

      resultRemoveButton.addEventListener("click", function () {
        if (!selectedEntry) {
          closeResultModal();
          return;
        }
        const idx = entries.findIndex((e) => e === selectedEntry);
        if (idx !== -1) {
          entries.splice(idx, 1);
        }
        selectedEntry = null;
        renderEntries();
        drawWheel();
        closeResultModal();
      });

      // Close modal on backdrop click
      resultModal.addEventListener("click", function (e) {
        if (e.target === resultModal) {
          closeResultModal();
        }
      });

      // ===== JSON IMPORT =====
      if (importJsonInput) {
        importJsonInput.addEventListener("change", function (e) {
          const file = e.target.files && e.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = function (evt) {
            try {
              const text = evt.target.result;
              const data = JSON.parse(text);

              // entries / employees for wheel
              if (Array.isArray(data.entries)) {
                entries = data.entries.slice();
              } else if (Array.isArray(data.products)) {
                entries = data.products.slice();
              }

              // employees pool
              if (Array.isArray(data.employees)) {
                employees = data.employees.slice();
              }

              // groupCount
              if (typeof data.groupCount === "number" && data.groupCount > 0) {
                groupCountInput.value = data.groupCount;
              }

              renderEntries();
              renderEmployees();
              drawWheel();
            } catch (err) {
              alert("Could not import JSON. Please check the file format.");
              console.error(err);
            }
          };
          reader.readAsText(file);

          // Allow re-importing same file
          importJsonInput.value = "";
        });
      }

      // ===== SPIN LOGIC =====
      function spinWheel() {
        if (isSpinning) return;

        // Validate game configuration first
        const configCheck = validateGameConfig();
        if (!configCheck.ok) {
          showSetupModal(configCheck.message);
          return;
        }

        if (entries.length === 0) return;

        danceBox1.classList.remove("hidden");
        danceBox2.classList.remove("hidden");

        isSpinning = true;
        centerLabel.textContent = "SPINNING…";
        spinButton.disabled = true;

        // Normalize angle so it doesn't grow forever
        const twoPi = Math.PI * 2;
        currentAngle = currentAngle % twoPi;
        if (currentAngle < 0) currentAngle += twoPi;

        const sliceAngle = twoPi / entries.length;
        const randomIndex = Math.floor(Math.random() * entries.length);
        selectedEntry = entries[randomIndex];

        // Segment center (relative to wheel)
        const segmentCenter = randomIndex * sliceAngle + sliceAngle / 2;

        // Pointer is at -90° (top)
        const pointerAngle = -Math.PI / 2;

        // Where we want the wheel to end
        const baseAngle = currentAngle;
        const stopAngle = pointerAngle - segmentCenter;

        const extraRotations = twoPi * 5; // 5 full spins, same every time
        const deltaToAlign = stopAngle - baseAngle;

        startAngle = baseAngle;
        targetAngle = baseAngle + extraRotations + deltaToAlign;

        spinStartTime = performance.now();

        function animateSpin(now) {
          const elapsed = now - spinStartTime;
          const t = Math.min(elapsed / spinDuration, 1);
          // Ease-out cubic
          const eased = 1 - Math.pow(1 - t, 3);

          currentAngle = startAngle + (targetAngle - startAngle) * eased;
          drawWheel();

          if (t < 1) {
            requestAnimationFrame(animateSpin);
          } else {
            isSpinning = false;
            centerLabel.innerHTML = "TAP TO<br>SPIN";
            spinButton.disabled = false;
            timesSpun += 1;
            updateStats();

            // === Select employees for this entry ===
            resultEmployeesList.innerHTML = "";
            resultEmployeesWrapper.classList.add("hidden");

            let groupCount = parseInt(groupCountInput.value, 10);
            if (isNaN(groupCount) || groupCount < 1) groupCount = 1;

            if (employees.length > 0) {
              const numToPick = Math.min(groupCount, employees.length);

              // Build list of indices and shuffle
              const indices = employees.map((_, i) => i);
              for (let i = indices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                const tmp = indices[i];
                indices[i] = indices[j];
                indices[j] = tmp;
              }

              const chosenIndices = indices.slice(0, numToPick).sort((a, b) => b - a); // descending for safe splice
              const chosenEmployees = [];

              chosenIndices.forEach((idx) => {
                chosenEmployees.push(employees[idx]);
                employees.splice(idx, 1); // remove from pool
              });

              chosenEmployees.forEach((name) => {
                const li = document.createElement("li");
                li.textContent = name;
                resultEmployeesList.appendChild(li);
              });

              resultEmployeesWrapper.classList.remove("hidden");
              renderEmployees();

              if (chosenEmployees.length) {
                groups.push({
                  entry: selectedEntry,
                  employees: chosenEmployees.slice(),
                  round: timesSpun
                });
                renderGroups();
              }
            }

            launchConfetti();
            showResultModal(selectedEntry);
            renderEntries(); // refresh highlight

            danceBox1.classList.add("hidden");
            danceBox2.classList.add("hidden");
          }
        }

        requestAnimationFrame(animateSpin);
      }

      // Click handlers
      spinButton.addEventListener("click", spinWheel);
      canvas.addEventListener("click", spinWheel);

      // ===== ADD ENTRY FORM =====
      addEntryForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const v = newEntryInput.value.trim();
        if (!v) return;
        entries.push(v);
        newEntryInput.value = "";
        renderEntries();
        drawWheel();
      });

      // ===== ADD EMPLOYEE FORM =====
      addEmployeeForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const v = newEmployeeInput.value.trim();
        if (!v) return;
        employees.push(v);
        newEmployeeInput.value = "";
        renderEmployees();
      });

      function renderGroups() {
        groupsList.innerHTML = "";

        if (!groups.length) {
          const empty = document.createElement("p");
          empty.className = "text-xs text-slate-400";
          empty.textContent =
            "No groups formed yet. Spin the wheel to create the first group.";
          groupsList.appendChild(empty);
          return;
        }

        groups.forEach((group, index) => {
          const card = document.createElement("div");
          card.className =
            "border border-slate-200 rounded-lg px-3 py-2 bg-slate-50";

          const title = document.createElement("div");
          title.className = "text-xs font-semibold text-slate-800 mb-1";
          title.textContent = `Group ${index + 1} – ${group.entry}`;

          const ul = document.createElement("ul");
          ul.className =
            "list-disc list-inside text-xs text-slate-700 space-y-0.5";

          group.employees.forEach((emp) => {
            const li = document.createElement("li");
            li.textContent = emp;
            ul.appendChild(li);
          });

          card.appendChild(title);
          card.appendChild(ul);
          groupsList.appendChild(card);
        });
      }


      // ===== INITIAL RENDER =====
      renderEntries();
      drawWheel();
      renderEmployees();
      renderGroups();
    });
  </script>
</body>
</html>
